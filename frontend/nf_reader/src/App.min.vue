<script setup>import{ ref} from "vue";const API_URL="http://localhost:5000";const fileInput=ref(null);const isDragging=ref(false);const isProcessing=ref(false);const error=ref(null);const result=ref(null);const handleFileSelect=(event)=>{ const file=event.target.files[0]; if (file) processFile(file)};const handleDrop=(event)=>{ isDragging.value=false; const file=event.dataTransfer.files[0]; if (file) processFile(file)};const processFile=async (file)=>{ const allowedTypes=["application/pdf", "image/jpeg", "image/png"]; if (!allowedTypes.includes(file.type)){ error.value="Tipo de arquivo não suportado. Use PDF, PNG ou JPEG."; return;} try{ error.value=null; isProcessing.value=true; result.value=null; const formData=new FormData(); formData.append("file", file); const response=await fetch(`${API_URL}/api/process-invoice`,{ method: "POST", body: formData,}); const data=await response.json(); if (!response.ok){ throw new Error(data.error || "Erro ao processar nota fiscal");} result.value=data;} catch (err){ console.error("Erro:", err); error.value=err.message;} finally{ isProcessing.value=false;}};const resetForm=()=>{ result.value=null; error.value=null; if (fileInput.value) fileInput.value.value=""};</script><template><div class="app-wrapper"><div class="container"><header class="app-header"><h1>Leitor de Notas Fiscais</h1><p>Faça o upload de notas fiscais em PDF ou imagem.</p></header><div class="content-area"><div class="upload-area" :class="{ 'is-dragging': isDragging}" @dragenter.prevent="isDragging=true" @dragleave.prevent="isDragging=false" @dragover.prevent @drop.prevent="handleDrop"><input type="file" ref="fileInput" class="file-input-hidden" @change="handleFileSelect" accept=".pdf,.png,.jpg,.jpeg" /><div v-if="!isProcessing && !result" class="upload-area-content"><svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3 3m0 0l-3-3m3 3V8" /></svg><p class="upload-text">Arraste e solte um arquivo aqui ou <button type="button" @click="$refs.fileInput.click()" class="upload-browse-button">clique para selecionar </button></p><p class="upload-hint">PDF, PNG, JPG ou JPEG</p></div><div v-if="isProcessing" class="processing-indicator"><div class="spinner"></div><p>Processando nota fiscal...</p></div></div><div v-if="error" class="error-message">{{ error}}</div><div v-if="result" class="results-section"><h2 class="results-title">Dados Extraídos</h2><div class="card results-card"><div class="results-grid"><div class="result-item"><p class="result-label">Número da NF</p><p class="result-value">{{ result["numero_da_nota_fiscal"]}}</p></div><div class="result-item"><p class="result-label">Data de Emissão</p><p class="result-value">{{ result["data_de_emissao"]}}</p></div><div class="result-item"><p class="result-label">Valor Total</p><p class="result-value">R${{ result["valor_total"]}}</p></div><div class="result-item"><p class="result-label">CNPJ Emitente</p><p class="result-value">{{ result["CNPJ_do_emitente"]}}</p></div></div><div class="result-group"><p class="result-label">Nome Emitente</p><p class="result-value">{{ result["nome/razao_social_do_emitente"]}} </p><p class="result-label mt-3">Endereço</p><p class="result-value">{{ result["endereco_do_emitente"]}}</p></div><div class="result-group"><p class="result-label">Chave de Acesso</p><p class="result-value break-all">{{ result["chave_de_acesso"]}}</p></div><div class="result-group"><h3 class="items-title">Itens da Nota</h3><div class="items-list"><div v-for="(item, index) in result['lista_de_itens']" :key="index" class="item-entry"><p class="item-description">{{ item["descricao"]}}</p><div class="item-details-grid"><div><span class="item-detail-label">Valor: </span><span class="item-detail-value">R${{ item["valor_unitario"]}}</span></div><div><span class="item-detail-label">Qtd: </span><span class="item-detail-value">{{ item["quantidade"]}}</span></div><div><span class="item-detail-label">Total: </span><span class="item-detail-value">R${{ item["valor_total"]}}</span></div></div></div></div></div></div><div class="new-invoice-action"><button @click="resetForm" class="btn btn-primary">Processar Nova Nota </button></div></div></div></div></div></template><style>*,*::before,*::after{ box-sizing: border-box; margin: 0; padding: 0}.app-wrapper{ font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f3f4f6; color: #1f2937; line-height: 1.6; padding: 1rem; min-height: 100vh}.container{ max-width: 800px; margin: 2rem auto; padding: 0 1rem; }.app-header{ text-align: center; margin-bottom: 2.5rem; }.app-header h1{ font-size: 2.25rem; font-weight: 700; color: #111827; margin-bottom: 0.5rem}.app-header p{ font-size: 1rem; color: #4b5563; }.content-area{ max-width: 700px; margin: 0 auto}.upload-area{ border: 2px dashed #cbd5e1; border-radius: 0.75rem; padding: 2.5rem; text-align: center; background-color: #ffffff; transition: border-color 0.2s ease, background-color 0.2s ease; margin-bottom: 1.5rem}.upload-area.is-dragging{ border-color: #3b82f6; background-color: #eff6ff; }.file-input-hidden{ display: none}.upload-area-content{}.upload-icon{ margin: 0 auto 1rem auto; height: 3rem; width: 3rem; color: #9ca3af; }.upload-text{ margin-top: 1rem; font-size: 1rem; color: #4b5563}.upload-browse-button{ color: #3b82f6; font-weight: 500; text-decoration: none; background: none; border: none; cursor: pointer; padding: 0}.upload-browse-button:hover{ color: #2563eb; text-decoration: underline}.upload-hint{ margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280; }.processing-indicator{ display: flex; flex-direction: column; align-items: center; justify-content: center; color: #4b5563}.spinner{ animation: spin 1s linear infinite; border-radius: 50%; height: 2.5rem; width: 2.5rem; border: 3px solid #e0e7ff; border-top-color: #3b82f6; margin-bottom: 1rem}@keyframes spin{ from{ transform: rotate(0deg);} to{ transform: rotate(360deg);}}.error-message{ margin-top: 1rem; margin-bottom: 1.5rem; padding: 1rem 1.25rem; background-color: #fee2e2; color: #b91c1c; border-radius: 0.5rem; border: 1px solid #fca5a5; font-size: 0.9rem}.results-section{ margin-top: 2.5rem; }.results-title{ font-size: 1.75rem; font-weight: 600; color: #111827; margin-bottom: 1.5rem; text-align: left; }.card{ background-color: #ffffff; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); padding: 2rem; }.results-card{} .results-grid{ display: grid; grid-template-columns: repeat( auto-fit, minmax(250px, 1fr) ); gap: 1.5rem; margin-bottom: 2rem; }.result-item{}.result-group{ margin-bottom: 2rem; }.result-group:last-child{ margin-bottom: 0}.result-label{ font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem; font-weight: 500; }.result-value{ font-size: 1rem; color: #1f2937; font-weight: 500; }.result-value.break-all{ word-break: break-all}.items-title{ font-size: 1.25rem; font-weight: 600; color: #1f2937; margin-bottom: 1.25rem; border-top: 1px solid #e5e7eb; padding-top: 1.5rem}.items-list{ space-y-4 >* + *{ margin-top: 1rem;}}.item-entry{ padding-bottom: 1rem; border-bottom: 1px solid #e5e7eb; }.items-list >.item-entry:last-child{ border-bottom: none; padding-bottom: 0}.item-description{ font-weight: 600; color: #1f2937; margin-bottom: 0.5rem}.item-details-grid{ display: grid; grid-template-columns: repeat( auto-fit, minmax(120px, 1fr) ); gap: 0.75rem; font-size: 0.875rem; }.item-detail-label{ color: #6b7280; }.item-detail-value{ color: #1f2937; font-weight: 500}.btn{ display: inline-block; padding: 0.75rem 1.5rem; font-size: 1rem; font-weight: 500; text-align: center; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease; border: 1px solid transparent}.btn-primary{ background-color: #3b82f6; color: #ffffff; }.btn-primary:hover{ background-color: #2563eb; }.new-invoice-action{ margin-top: 2rem; text-align: center}.hidden{ display: none}.mt-2{ margin-top: 0.5rem}.mt-3{ margin-top: 0.75rem} .text-sm{ font-size: 0.875rem}.font-semibold{ font-weight: 600}.font-medium{ font-weight: 500}</style>